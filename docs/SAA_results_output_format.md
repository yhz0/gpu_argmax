## Structure of the SAA Results HDF5 File

This document outlines the structure of the HDF5 file (`<problem_name>_<N>scen_results.h5`) generated by the `build_saa.py` script.

### Root Level Groups:

The file is organized into the following main groups at the root level:

1.  `/metadata`
2.  `/scenarios`
3.  `/solution`
4.  `/basis`

### 1. `/metadata` Group

This group contains attributes providing context about the SAA problem and its solution.

* **Attributes:**
    * `problem_name` (string): The base name of the SMPS problem.
    * `num_scenarios` (int): The number of scenarios (N) used in the SAA model.
    * `random_seed` (int): The random seed used for scenario generation.
    * `num_x` (int): Number of first-stage variables.
    * `num_y` (int): Number of second-stage variables per scenario.
    * `num_cons1` (int): Number of first-stage constraints.
    * `num_cons2` (int): Number of second-stage constraints per scenario.
    * `num_stochastic_elements` (int): Number of unique RHS elements specified as stochastic in the `.sto` file.
    * `solution_status_code` (int): The Gurobi status code after optimization (e.g., 2 for Optimal, 3 for Infeasible). -1 if solve wasn't completed.
    * `optimal_objective` (float): The optimal objective function value (only present if `solution_status_code` is Optimal).

### 2. `/scenarios` Group

Contains information about the generated scenarios.

* **Datasets:**
    * `stochastic_rhs_parts` (Dataset, float, shape: `(N, num_stochastic_elements)`):
        * Contains *only* the sampled values for the stochastic elements identified in the `.sto` file.
        * Each row corresponds to a scenario.
        * Each column corresponds to one of the stochastic elements in the order they were processed.
        * If there are no stochastic elements (`num_stochastic_elements == 0`), this will be an empty dataset with shape `(N, 0)`.
        * *Compression: gzip*

### 3. `/solution` Group

Contains the primal and dual solution information, **populated only if the model was solved to optimality**. If not optimal, datasets will exist but may be empty placeholders.

* **Subgroups:**
    * `/solution/primal`:
        * `x` (Dataset, float, shape: `(num_x,)`):
            * The optimal values of the first-stage decision variables.
            * *Compression: gzip*
        * `y_s` (Dataset, float, shape: `(N, num_y)`):
            * The optimal values of the second-stage decision variables for each scenario.
            * Row `s` contains the `y` vector for scenario `s`.
            * *Compression: gzip*
    * `/solution/dual`:
        * `pi_s` (Dataset, float, shape: `(N, num_cons2)`):
            * The optimal **unscaled** dual variable values (shadow prices) associated with the second-stage constraints (`Dy <= r_s - Cx`) for each **individual scenario subproblem**.
            * These are derived by multiplying the dual values obtained from the SAA extensive form solution by the total number of scenarios (N).
            * Row `s` contains the unscaled dual vector `pi` for the second-stage constraints corresponding to scenario `s`.
            * *Compression: gzip*

### 4. `/basis` Group

Contains the optimal basis information, **populated only if the model was solved to optimality**. If not optimal or if basis extraction failed, datasets will exist but may be empty placeholders.

* **Datasets:** (Stored as `int8`, representing Gurobi basis status codes: e.g., 0=basic, -1=nonbasic at lower, -2=nonbasic at upper, -3=superbasic)
    * `cbasis_x` (Dataset, int8, shape: `(num_cons1,)`):
        * Basis status for the first-stage constraints.
        * *Compression: gzip*
    * `vbasis_x` (Dataset, int8, shape: `(num_x,)`):
        * Basis status for the first-stage variables.
        * *Compression: gzip*
    * `cbasis_y_all` (Dataset, int8, shape: `(N, num_cons2)`):
        * Basis status for the second-stage constraints for each scenario.
        * Row `s` corresponds to scenario `s`.
        * *Compression: gzip*
    * `vbasis_y_all` (Dataset, int8, shape: `(N, num_y)`):
        * Basis status for the second-stage variables for each scenario.
        * Row `s` corresponds to scenario `s`.
        * *Compression: gzip*

**Note on Empty Placeholders:** If the model did not solve to optimality, or if certain parts of the problem don't exist (e.g., no second-stage variables), the corresponding datasets under `/solution` and `/basis` will still be created but will be empty arrays with the correct number of dimensions (e.g., shape `(N, 0)` if `num_y` is 0) to maintain a consistent file structure.
